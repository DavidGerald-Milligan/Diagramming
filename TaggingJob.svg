<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2431.4136px" preserveAspectRatio="none" style="width:603px;height:2431px;" version="1.1" viewBox="0 0 603 2431" width="603.1414px" zoomAndPan="magnify"><defs><filter height="300%" id="f1lqr07lff4sdp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="3.141361256544503"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="6.282722513089006" dy="6.282722513089006" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="254.4503" cy="31.4136" fill="#000000" filter="url(#f1lqr07lff4sdp)" rx="15.7068" ry="15.7068" style="stroke: none; stroke-width: 1.5706806282722514;"/><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="240.3141" x="134.2932" y="78.534"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="208.9005" x="150" y="113.8069">create tagging operation</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="232.4607" x="138.2199" y="165.0687"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="201.0471" x="153.9267" y="200.3415">add tags with metadata</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="263.8743" x="122.5131" y="338.1381"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="232.4607" x="138.2199" y="373.4109">identify shard for document</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="318.8482" x="95.0262" y="424.6728"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="287.4346" x="110.733" y="459.9456">extract with ids from family id path</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="256.0209" x="126.4398" y="597.7421"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="224.6073" x="142.1466" y="633.015">create sub operation for id</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="119.3717" x="194.7644" y="707.837"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="87.9581" x="210.4712" y="743.1099">add shard</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="204.1885" x="152.356" y="810.508"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="172.7749" x="168.0628" y="845.7808">add required tag ids</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="149.2147" x="179.8429" y="897.0427"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="117.801" x="195.5497" y="932.3155">add source id</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="83.2461" x="212.8272" y="511.2075"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="47.1204" x="233.2461" y="546.4803">get id</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="205.7592,983.5774,303.1414,983.5774,321.9895,1002.4256,303.1414,1021.2737,205.7592,1021.2737,186.911,1002.4256,205.7592,983.5774" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="97.3822" x="205.7592" y="1009.4952">has more ids</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="28.2723" x="321.9895" y="998.6292">yes</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="312.5654" x="98.1675" y="251.6034"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="276.4398" x="118.5864" y="286.8762">for each source document to tag</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="151.5707,1052.6873,357.3298,1052.6873,376.178,1071.5355,357.3298,1090.3837,151.5707,1090.3837,132.7225,1071.5355,151.5707,1052.6873" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="205.7592" x="151.5707" y="1078.6051">has more documents to tag</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="304.712" x="102.0942" y="1121.7973"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="273.2984" x="117.801" y="1157.0701">send operation to Elasticsearch</text><ellipse cx="254.4503" cy="1224.0388" fill="#FFFFFF" filter="url(#f1lqr07lff4sdp)" rx="15.7068" ry="15.7068" style="stroke: #000000; stroke-width: 2.356020942408377;"/><line style="stroke: #000000; stroke-width: 3.9267015706806285;" x1="244.7322" x2="264.1684" y1="1214.3207" y2="1233.7569"/><line style="stroke: #000000; stroke-width: 3.9267015706806285;" x1="264.1684" x2="244.7322" y1="1214.3207" y2="1233.7569"/><path d="M15.7068,1255.4524 L15.7068,1296.8423 A0,0 0 0 0 15.7068,1296.8423 L207.3298,1296.8423 A0,0 0 0 0 207.3298,1296.8423 L207.3298,1283.7246 L238.7435,1276.1473 L207.3298,1271.1592 L207.3298,1271.1592 L191.623,1255.4524 L15.7068,1255.4524 A0,0 0 0 0 15.7068,1255.4524 " fill="#FBFB77" filter="url(#f1lqr07lff4sdp)" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><path d="M191.623,1255.4524 L191.623,1271.1592 L207.3298,1271.1592 L191.623,1255.4524 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><text fill="#000000" font-family="sans-serif" font-size="20.4188" lengthAdjust="spacingAndGlyphs" textLength="158.6387" x="25.1309" y="1284.5023">on Elasticsearch;</text><ellipse cx="254.4503" cy="1276.1473" fill="#000000" filter="url(#f1lqr07lff4sdp)" rx="15.7068" ry="15.7068" style="stroke: none; stroke-width: 1.5706806282722514;"/><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="262.3037" x="123.2984" y="1328.2559"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="230.8901" x="139.0052" y="1363.5287">load stored Painless script</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="204.1885" x="152.356" y="1501.3253"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="172.7749" x="168.0628" y="1536.5981">extract tag metadata</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="342.4084" x="83.2461" y="1587.8599"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="310.9948" x="98.9529" y="1623.1328">load document from specified shard</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="217.5393,1760.9293,291.3613,1760.9293,310.2094,1779.7775,291.3613,1798.6257,217.5393,1798.6257,198.6911,1779.7775,217.5393,1760.9293" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="73.822" x="217.5393" y="1786.8471">tag exists</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="18.8482" x="179.8429" y="1775.9812">no</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="28.2723" x="310.2094" y="1775.9812">yes</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="108.377" x="62.8272" y="1814.3325"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="76.9634" x="78.534" y="1849.6053">apply tag</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="141.3613" x="46.3351" y="1924.4274"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="109.9476" x="62.0419" y="1959.7002">apply source</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="340.0524,1814.3325,443.7173,1814.3325,462.5654,1833.1806,443.7173,1852.0288,340.0524,1852.0288,321.2042,1833.1806,340.0524,1814.3325" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="103.6649" x="340.0524" y="1840.2502">source exists</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="18.8482" x="302.356" y="1829.3843">no</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="28.2723" x="462.5654" y="1829.3843">yes</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="141.3613" x="234.8168" y="1867.7356"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="109.9476" x="250.5236" y="1903.0084">apply source</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="67.5393" x="444.5026" y="1867.7356"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="36.1257" x="460.2094" y="1903.0084">skip</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="391.8848,1932.2808,410.733,1951.1289,391.8848,1969.9771,373.0366,1951.1289,391.8848,1932.2808" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="254.4503,1988.9725,273.2984,2007.8207,254.4503,2026.6688,235.6021,2007.8207,254.4503,1988.9725" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="136.6492" x="186.1257" y="1674.3946"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="100.5236" x="206.5445" y="1709.6675">for each tag</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="200.2618,2058.0825,308.6387,2058.0825,327.4869,2076.9306,308.6387,2095.7788,200.2618,2095.7788,181.4136,2076.9306,200.2618,2058.0825" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="108.377" x="200.2618" y="2084.0002">has more tags</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="28.2723" x="327.4869" y="2073.1343">yes</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="175.9162,2127.1924,332.9843,2127.1924,351.8325,2146.0406,332.9843,2164.8887,175.9162,2164.8887,157.0681,2146.0406,175.9162,2127.1924" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="157.0681" x="175.9162" y="2153.1102">is document updated</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="28.2723" x="128.7958" y="2142.2443">yes</text><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="18.8482" x="351.8325" y="2142.2443">no</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="185.3403" x="48.6911" y="2180.5955"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="153.9267" x="64.3979" y="2215.8684">reindex document</text><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="67.5393" x="333.7696" y="2180.5955"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="36.1257" x="349.4764" y="2215.8684">skip</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="254.4503,2245.1407,273.2984,2263.9889,254.4503,2282.837,235.6021,2263.9889,254.4503,2245.1407" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><rect fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" height="55.1211" rx="19.6335" ry="19.6335" style="stroke: #A80036; stroke-width: 2.356020942408377;" width="224.6073" x="142.1466" y="1414.7906"/><text fill="#000000" font-family="sans-serif" font-size="18.8482" lengthAdjust="spacingAndGlyphs" textLength="188.4817" x="162.5654" y="1450.0634">for each suboperation</text><polygon fill="#FEFECE" filter="url(#f1lqr07lff4sdp)" points="176.7016,2314.2507,332.199,2314.2507,351.0471,2333.0988,332.199,2351.947,176.7016,2351.947,157.8534,2333.0988,176.7016,2314.2507" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><text fill="#000000" font-family="sans-serif" font-size="17.2775" lengthAdjust="spacingAndGlyphs" textLength="155.4974" x="176.7016" y="2340.1684">has more operations</text><ellipse cx="254.4503" cy="2399.0674" fill="#FFFFFF" filter="url(#f1lqr07lff4sdp)" rx="15.7068" ry="15.7068" style="stroke: #000000; stroke-width: 2.356020942408377;"/><line style="stroke: #000000; stroke-width: 3.9267015706806285;" x1="244.7322" x2="264.1684" y1="2389.3493" y2="2408.7855"/><line style="stroke: #000000; stroke-width: 3.9267015706806285;" x1="264.1684" x2="244.7322" y1="2389.3493" y2="2408.7855"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="47.1204" y2="78.534"/><polygon fill="#A80036" points="248.1675,62.8272,254.4503,78.534,260.733,62.8272,254.4503,69.1099" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="133.6551" y2="165.0687"/><polygon fill="#A80036" points="248.1675,149.3619,254.4503,165.0687,260.733,149.3619,254.4503,155.6446" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="393.2592" y2="424.6728"/><polygon fill="#A80036" points="248.1675,408.966,254.4503,424.6728,260.733,408.966,254.4503,415.2487" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="652.8632" y2="707.837"/><polygon fill="#A80036" points="248.1675,692.1302,254.4503,707.837,260.733,692.1302,254.4503,698.413" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="762.9581" y2="810.508"/><polygon fill="#A80036" points="248.1675,794.8012,254.4503,810.508,260.733,794.8012,254.4503,801.0839" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="865.6291" y2="897.0427"/><polygon fill="#A80036" points="248.1675,881.3359,254.4503,897.0427,260.733,881.3359,254.4503,887.6186" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="566.3285" y2="597.7421"/><polygon fill="#A80036" points="248.1675,582.0353,254.4503,597.7421,260.733,582.0353,254.4503,588.3181" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="321.9895" x2="401.3089" y1="1002.4256" y2="1002.4256"/><polygon fill="#A80036" points="395.0262,794.3717,401.3089,778.6649,407.5916,794.3717,401.3089,788.089" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="401.3089" x2="401.3089" y1="538.768" y2="1002.4256"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="401.3089" x2="296.0733" y1="538.768" y2="538.768"/><polygon fill="#A80036" points="311.7801,532.4853,296.0733,538.768,311.7801,545.0507,305.4974,538.768" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="952.1638" y2="983.5774"/><polygon fill="#A80036" points="248.1675,967.8706,254.4503,983.5774,260.733,967.8706,254.4503,974.1533" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="479.7938" y2="511.2075"/><polygon fill="#A80036" points="248.1675,495.5007,254.4503,511.2075,260.733,495.5007,254.4503,501.7834" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="306.7245" y2="338.1381"/><polygon fill="#A80036" points="248.1675,322.4313,254.4503,338.1381,260.733,322.4313,254.4503,328.714" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="376.178" x2="439.0052" y1="1071.5355" y2="1071.5355"/><polygon fill="#A80036" points="432.7225,682.9884,439.0052,667.2816,445.288,682.9884,439.0052,676.7057" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="439.0052" x2="439.0052" y1="279.1639" y2="1071.5355"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="439.0052" x2="410.733" y1="279.1639" y2="279.1639"/><polygon fill="#A80036" points="426.4398,272.8812,410.733,279.1639,426.4398,285.4467,420.1571,279.1639" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1021.2737" y2="1052.6873"/><polygon fill="#A80036" points="248.1675,1036.9805,254.4503,1052.6873,260.733,1036.9805,254.4503,1043.2633" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="220.1898" y2="251.6034"/><polygon fill="#A80036" points="248.1675,235.8966,254.4503,251.6034,260.733,235.8966,254.4503,242.1793" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1090.3837" y2="1121.7973"/><polygon fill="#A80036" points="248.1675,1106.0905,254.4503,1121.7973,260.733,1106.0905,254.4503,1112.3732" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1176.9184" y2="1208.332"/><polygon fill="#A80036" points="248.1675,1192.6252,254.4503,1208.332,260.733,1192.6252,254.4503,1198.9079" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1291.8541" y2="1328.2559"/><polygon fill="#A80036" points="248.1675,1312.5491,254.4503,1328.2559,260.733,1312.5491,254.4503,1318.8318" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1556.4463" y2="1587.8599"/><polygon fill="#A80036" points="248.1675,1572.1531,254.4503,1587.8599,260.733,1572.1531,254.4503,1578.4359" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="117.0157" x2="117.0157" y1="1869.4535" y2="1924.4274"/><polygon fill="#A80036" points="110.733,1908.7205,117.0157,1924.4274,123.2984,1908.7205,117.0157,1915.0033" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="321.2042" x2="305.4974" y1="1833.1806" y2="1833.1806"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="305.4974" x2="305.4974" y1="1833.1806" y2="1867.7356"/><polygon fill="#A80036" points="299.2147,1852.0288,305.4974,1867.7356,311.7801,1852.0288,305.4974,1858.3115" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="462.5654" x2="478.2723" y1="1833.1806" y2="1833.1806"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="478.2723" x2="478.2723" y1="1833.1806" y2="1867.7356"/><polygon fill="#A80036" points="471.9895,1852.0288,478.2723,1867.7356,484.555,1852.0288,478.2723,1858.3115" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="305.4974" x2="305.4974" y1="1922.8567" y2="1951.1289"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="305.4974" x2="373.0366" y1="1951.1289" y2="1951.1289"/><polygon fill="#A80036" points="357.3298,1944.8462,373.0366,1951.1289,357.3298,1957.4116,363.6126,1951.1289" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="478.2723" x2="478.2723" y1="1922.8567" y2="1951.1289"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="478.2723" x2="410.733" y1="1951.1289" y2="1951.1289"/><polygon fill="#A80036" points="426.4398,1944.8462,410.733,1951.1289,426.4398,1957.4116,420.1571,1951.1289" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="198.6911" x2="117.0157" y1="1779.7775" y2="1779.7775"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="117.0157" x2="117.0157" y1="1779.7775" y2="1814.3325"/><polygon fill="#A80036" points="110.733,1798.6257,117.0157,1814.3325,123.2984,1798.6257,117.0157,1804.9084" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="310.2094" x2="391.8848" y1="1779.7775" y2="1779.7775"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="391.8848" x2="391.8848" y1="1779.7775" y2="1814.3325"/><polygon fill="#A80036" points="385.6021,1798.6257,391.8848,1814.3325,398.1675,1798.6257,391.8848,1804.9084" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="117.0157" x2="117.0157" y1="1979.5484" y2="2007.8207"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="117.0157" x2="235.6021" y1="2007.8207" y2="2007.8207"/><polygon fill="#A80036" points="219.8953,2001.538,235.6021,2007.8207,219.8953,2014.1034,226.178,2007.8207" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="391.8848" x2="391.8848" y1="1969.9771" y2="2007.8207"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="391.8848" x2="273.2984" y1="2007.8207" y2="2007.8207"/><polygon fill="#A80036" points="289.0052,2001.538,273.2984,2007.8207,289.0052,2014.1034,282.7225,2007.8207" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1729.5157" y2="1760.9293"/><polygon fill="#A80036" points="248.1675,1745.2225,254.4503,1760.9293,260.733,1745.2225,254.4503,1751.5052" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="327.4869" x2="534.0314" y1="2076.9306" y2="2076.9306"/><polygon fill="#A80036" points="527.7487,1905.1497,534.0314,1889.4429,540.3141,1905.1497,534.0314,1898.867" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="534.0314" x2="534.0314" y1="1701.9552" y2="2076.9306"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="534.0314" x2="322.7749" y1="1701.9552" y2="1701.9552"/><polygon fill="#A80036" points="338.4817,1695.6724,322.7749,1701.9552,338.4817,1708.2379,332.199,1701.9552" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="2026.6688" y2="2058.0825"/><polygon fill="#A80036" points="248.1675,2042.3757,254.4503,2058.0825,260.733,2042.3757,254.4503,2048.6584" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1642.981" y2="1674.3946"/><polygon fill="#A80036" points="248.1675,1658.6878,254.4503,1674.3946,260.733,1658.6878,254.4503,1664.9705" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="157.0681" x2="141.3613" y1="2146.0406" y2="2146.0406"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="141.3613" x2="141.3613" y1="2146.0406" y2="2180.5955"/><polygon fill="#A80036" points="135.0785,2164.8887,141.3613,2180.5955,147.644,2164.8887,141.3613,2171.1715" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="351.8325" x2="367.5393" y1="2146.0406" y2="2146.0406"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="367.5393" x2="367.5393" y1="2146.0406" y2="2180.5955"/><polygon fill="#A80036" points="361.2565,2164.8887,367.5393,2180.5955,373.822,2164.8887,367.5393,2171.1715" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="141.3613" x2="141.3613" y1="2235.7166" y2="2263.9889"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="141.3613" x2="235.6021" y1="2263.9889" y2="2263.9889"/><polygon fill="#A80036" points="219.8953,2257.7062,235.6021,2263.9889,219.8953,2270.2716,226.178,2263.9889" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="367.5393" x2="367.5393" y1="2235.7166" y2="2263.9889"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="367.5393" x2="273.2984" y1="2263.9889" y2="2263.9889"/><polygon fill="#A80036" points="289.0052,2257.7062,273.2984,2263.9889,289.0052,2270.2716,282.7225,2263.9889" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="2095.7788" y2="2127.1924"/><polygon fill="#A80036" points="248.1675,2111.4856,254.4503,2127.1924,260.733,2111.4856,254.4503,2117.7683" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1469.9116" y2="1501.3253"/><polygon fill="#A80036" points="248.1675,1485.6185,254.4503,1501.3253,260.733,1485.6185,254.4503,1491.9012" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="351.0471" x2="562.3037" y1="2333.0988" y2="2333.0988"/><polygon fill="#A80036" points="556.0209,1891.6517,562.3037,1875.9449,568.5864,1891.6517,562.3037,1885.3689" style="stroke: #A80036; stroke-width: 2.356020942408377;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="562.3037" x2="562.3037" y1="1442.3511" y2="2333.0988"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="562.3037" x2="366.7539" y1="1442.3511" y2="1442.3511"/><polygon fill="#A80036" points="382.4607,1436.0684,366.7539,1442.3511,382.4607,1448.6338,376.178,1442.3511" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="2282.837" y2="2314.2507"/><polygon fill="#A80036" points="248.1675,2298.5438,254.4503,2314.2507,260.733,2298.5438,254.4503,2304.8266" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="1383.377" y2="1414.7906"/><polygon fill="#A80036" points="248.1675,1399.0838,254.4503,1414.7906,260.733,1399.0838,254.4503,1405.3665" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><line style="stroke: #A80036; stroke-width: 2.356020942408377;" x1="254.4503" x2="254.4503" y1="2351.947" y2="2383.3606"/><polygon fill="#A80036" points="248.1675,2367.6538,254.4503,2383.3606,260.733,2367.6538,254.4503,2373.9365" style="stroke: #A80036; stroke-width: 1.5706806282722514;"/><!--MD5=[17faa612b8368ae9d0256a252e53f8c9]
@startuml
scale 600 width
start
:create tagging operation;
:add tags with metadata;
repeat : for each source document to tag;
    :identify shard for document;
    :extract with ids from family id path;
    repeat : get id;
        :create sub operation for id;
        :add shard;
        :add required tag ids;
        :add source id;
    repeat while(has more ids) is (yes);
repeat while(has more documents to tag);

:send operation to Elasticsearch;

end

start
note: on Elasticsearch;
:load stored Painless script;
repeat : for each suboperation;
    :extract tag metadata;
    :load document from specified shard;
    repeat : for each tag;
        if (tag exists) then (no)
            :apply tag;
            :apply source;
        else (yes)
            if (source exists) then (no)
                :apply source;
            else (yes)
                :skip;
            endif
        endif
    repeat while (has more tags) is (yes);
    if (is document updated) then (yes)
        :reindex document;
    else (no)
        :skip;
    endif
repeat while (has more operations);
end
@enduml

PlantUML version 1.2020.03beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.4+10-b304.77
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>