<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="658.75px" preserveAspectRatio="none" style="width:810px;height:658px;" version="1.1" viewBox="0 0 810 658" width="810px" zoomAndPan="magnify"><defs><filter height="300%" id="f1254f345x1vwb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.5"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="5.0" dy="5.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><path d="M138.125,12.5 L138.125,106.7578 L388.125,106.7578 L388.125,25 L375.625,12.5 L138.125,12.5 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M375.625,12.5 L375.625,25 L388.125,25 L375.625,12.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="136.25" x="145.625" y="35.6189">A document exists</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="175" x="145.625" y="56.0583">With repo == sharepoint</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="117.5" x="145.625" y="76.4978">Is head of family</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="223.75" x="145.625" y="96.9373">Not yet tagged to a datasource</text><path d="M438.125,32.9395 L438.125,86.3184 L629.375,86.3184 L629.375,45.4395 L616.875,32.9395 L438.125,32.9395 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M616.875,32.9395 L616.875,45.4395 L629.375,45.4395 L616.875,32.9395 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="145" x="445.625" y="56.0583">A datasource exists</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="165" x="445.625" y="76.4978">For repo == sharepoint</text><ellipse cx="413.125" cy="59.6289" fill="#000000" filter="url(#f1254f345x1vwb)" rx="12.5" ry="12.5" style="stroke: none; stroke-width: 1.25;"/><path d="M323.125,200.625 L323.125,274.4434 L503.125,274.4434 L503.125,213.125 L490.625,200.625 L323.125,200.625 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M490.625,200.625 L490.625,213.125 L503.125,213.125 L490.625,200.625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="103.75" x="330.625" y="223.7439">For all tenants</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="153.75" x="330.625" y="244.1833">Apply datasource tag</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="145" x="330.625" y="264.6228">to untagged families</text><path d="M500.625,286.9434 L500.625,359.7314 L475.625,364.7314 L500.625,369.7314 L500.625,442.5195 A0,0 0 0 0 500.625,442.5195 L763.125,442.5195 A0,0 0 0 0 763.125,442.5195 L763.125,299.4434 L750.625,286.9434 L500.625,286.9434 A0,0 0 0 0 500.625,286.9434 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M750.625,286.9434 L750.625,299.4434 L763.125,299.4434 L750.625,286.9434 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="188.75" x="508.125" y="310.0623">Where repo == sharepoint</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="151.25" x="508.125" y="330.5017">And is head of family</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="96.25" x="508.125" y="350.9412">AND EITHER</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="236.25" x="508.125" y="371.3806">Not already tagged with DS == 1</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="17.5" x="508.125" y="391.8201">Or</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="228.75" x="508.125" y="412.2595">Has children not already tagged</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="95" x="508.125" y="432.699">with DS == 1</text><rect fill="#FEFECE" filter="url(#f1254f345x1vwb)" height="43.8672" rx="15.625" ry="15.625" style="stroke: #A80036; stroke-width: 1.875;" width="125" x="350.625" y="342.7979"/><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacingAndGlyphs" textLength="100" x="363.125" y="370.8691">Build ES query</text><path d="M12.5,462.7637 L12.5,516.1426 A0,0 0 0 0 12.5,516.1426 L291.25,516.1426 A0,0 0 0 0 291.25,516.1426 L291.25,494.4531 L316.25,489.4531 L291.25,484.4531 L291.25,475.2637 L278.75,462.7637 L12.5,462.7637 A0,0 0 0 0 12.5,462.7637 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M278.75,462.7637 L278.75,475.2637 L291.25,475.2637 L278.75,462.7637 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="252.5" x="20" y="485.8826">Our doc and all children are tagged</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="146.25" x="20" y="506.322">if not already tagged</text><rect fill="#FEFECE" filter="url(#f1254f345x1vwb)" height="43.8672" rx="15.625" ry="15.625" style="stroke: #A80036; stroke-width: 1.875;" width="193.75" x="316.25" y="467.5195"/><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacingAndGlyphs" textLength="168.75" x="328.75" y="495.5908">Call Legacy Tagging Job</text><rect fill="#FEFECE" filter="url(#f1254f345x1vwb)" height="43.8672" rx="15.625" ry="15.625" style="stroke: #A80036; stroke-width: 1.875;" width="102.5" x="361.875" y="131.7578"/><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacingAndGlyphs" textLength="73.75" x="378.125" y="159.8291">once a day</text><polygon fill="#FEFECE" filter="url(#f1254f345x1vwb)" points="396.875,541.1426,429.375,541.1426,444.375,556.1426,429.375,571.1426,396.875,571.1426,381.875,556.1426,396.875,541.1426" style="stroke: #A80036; stroke-width: 1.875;"/><text fill="#000000" font-family="sans-serif" font-size="13.75" lengthAdjust="spacingAndGlyphs" textLength="32.5" x="396.875" y="561.7688">sleep</text><path d="M36.875,591.3867 L36.875,644.7656 A0,0 0 0 0 36.875,644.7656 L268.125,644.7656 A0,0 0 0 0 268.125,644.7656 L268.125,623.0762 L293.125,618.0762 L268.125,613.0762 L268.125,603.8867 L255.625,591.3867 L36.875,591.3867 A0,0 0 0 0 36.875,591.3867 " fill="#FBFB77" filter="url(#f1254f345x1vwb)" style="stroke: #A80036; stroke-width: 1.25;"/><path d="M255.625,591.3867 L255.625,603.8867 L268.125,603.8867 L255.625,591.3867 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="205" x="44.375" y="614.5056">New doc will now get tagged</text><text fill="#000000" font-family="sans-serif" font-size="16.25" lengthAdjust="spacingAndGlyphs" textLength="86.25" x="44.375" y="634.9451">on next run.</text><rect fill="#FEFECE" filter="url(#f1254f345x1vwb)" height="43.8672" rx="15.625" ry="15.625" style="stroke: #A80036; stroke-width: 1.875;" width="240" x="293.125" y="596.1426"/><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacingAndGlyphs" textLength="215" x="305.625" y="624.2139">New child doc added to our doc</text><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="274.4434" y2="342.7979"/><polygon fill="#A80036" points="408.125,330.2979,413.125,342.7979,418.125,330.2979,413.125,335.2979" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="386.665" y2="467.5195"/><polygon fill="#A80036" points="408.125,455.0195,413.125,467.5195,418.125,455.0195,413.125,460.0195" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="175.625" y2="200.625"/><polygon fill="#A80036" points="408.125,188.125,413.125,200.625,418.125,188.125,413.125,193.125" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="444.375" x2="778.125" y1="556.1426" y2="556.1426"/><polygon fill="#A80036" points="773.125,363.5449,778.125,351.0449,783.125,363.5449,778.125,358.5449" style="stroke: #A80036; stroke-width: 1.875;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="778.125" x2="778.125" y1="153.6914" y2="556.1426"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="778.125" x2="464.375" y1="153.6914" y2="153.6914"/><polygon fill="#A80036" points="476.875,148.6914,464.375,153.6914,476.875,158.6914,471.875,153.6914" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="511.3867" y2="541.1426"/><polygon fill="#A80036" points="408.125,528.6426,413.125,541.1426,418.125,528.6426,413.125,533.6426" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="72.1289" y2="131.7578"/><polygon fill="#A80036" points="408.125,119.2578,413.125,131.7578,418.125,119.2578,413.125,124.2578" style="stroke: #A80036; stroke-width: 1.25;"/><line style="stroke: #A80036; stroke-width: 1.875;" x1="413.125" x2="413.125" y1="571.1426" y2="596.1426"/><polygon fill="#A80036" points="408.125,583.6426,413.125,596.1426,418.125,583.6426,413.125,588.6426" style="stroke: #A80036; stroke-width: 1.25;"/><!--MD5=[8d512b7890047b95d985184ff2908b4b]
@startuml
start
note left
A document exists
With repo == sharepoint
Is head of family
Not yet tagged to a datasource
end note
note right
A datasource exists
For repo == sharepoint
end note
repeat : once a day;
note right
For all tenants
Apply datasource tag
to untagged families
end note
:Build ES query;
note right
Where repo == sharepoint
And is head of family
AND EITHER
Not already tagged with DS == 1
Or
Has children not already tagged
with DS == 1
end note
:Call Legacy Tagging Job;
repeat while (sleep);
note left
Our doc and all children are tagged
if not already tagged
end note
:New child doc added to our doc;
note left
New doc will now get tagged
on next run.
end note
@enduml

PlantUML version 1.2020.03beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.4+10-b304.77
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>