<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1803px" preserveAspectRatio="none" style="width:406px;height:1803px;" version="1.1" viewBox="0 0 406 1803" width="406.5px" zoomAndPan="magnify"><defs><filter height="300%" id="f12p1fqaosbsqh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="3.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="6.0" dy="6.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="186.75" cy="30" fill="#000000" filter="url(#f12p1fqaosbsqh)" rx="15" ry="15" style="stroke: none; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="229.5" x="72" y="75"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="199.5" x="87" y="108.6855">create tagging operation</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="222" x="75.75" y="157.6406"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="192" x="90.75" y="191.3262">add tags with metadata</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="252" x="60.75" y="322.9219"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="222" x="75.75" y="356.6074">identify shard for document</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="304.5" x="34.5" y="405.5625"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="274.5" x="49.5" y="439.248">extract with ids from family id path</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="244.5" x="64.5" y="570.8438"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="214.5" x="79.5" y="604.5293">create sub operation for id</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="114" x="129.75" y="653.4844"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="84" x="144.75" y="687.1699">add shard</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="195" x="89.25" y="736.125"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="165" x="104.25" y="769.8105">add required tag ids</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="79.5" x="147" y="488.2031"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="45" x="166.5" y="521.8887">get id</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="140.25,818.7656,233.25,818.7656,251.25,836.7656,233.25,854.7656,140.25,854.7656,122.25,836.7656,140.25,818.7656" style="stroke: #A80036; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="93" x="140.25" y="843.5171">has more ids</text><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="27" x="251.25" y="833.1401">yes</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="237" x="68.25" y="240.2813"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="202.5" x="87.75" y="273.9668">for each document to tag</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="88.5,884.7656,285,884.7656,303,902.7656,285,920.7656,88.5,920.7656,70.5,902.7656,88.5,884.7656" style="stroke: #A80036; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="196.5" x="88.5" y="909.5171">has more documents to tag</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="291" x="41.25" y="950.7656"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="261" x="56.25" y="984.4512">send operation to Elasticsearch</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="250.5" x="61.5" y="1116.0469"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="220.5" x="76.5" y="1149.7324">load stored Painless script</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="195" x="89.25" y="1198.6875"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="165" x="104.25" y="1232.373">extract tag metadata</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="327" x="23.25" y="1281.3281"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="297" x="38.25" y="1315.0137">load document from specified shard</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="151.5,1446.6094,222,1446.6094,240,1464.6094,222,1482.6094,151.5,1482.6094,133.5,1464.6094,151.5,1446.6094" style="stroke: #A80036; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="70.5" x="151.5" y="1471.3608">tag exists</text><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="27" x="106.5" y="1460.9839">yes</text><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="18" x="240" y="1460.9839">no</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="187.5" x="15" y="1497.6094"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="157.5" x="30" y="1531.2949">apply tag and index</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="64.5" x="232.5" y="1497.6094"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="34.5" x="247.5" y="1531.2949">skip</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="186.75,1559.25,204.75,1577.25,186.75,1595.25,168.75,1577.25,186.75,1559.25" style="stroke: #A80036; stroke-width: 2.25;"/><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="130.5" x="121.5" y="1363.9688"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="96" x="141" y="1397.6543">for each tag</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="135,1625.25,238.5,1625.25,256.5,1643.25,238.5,1661.25,135,1661.25,117,1643.25,135,1625.25" style="stroke: #A80036; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="103.5" x="135" y="1650.0015">has more tags</text><rect fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" height="52.6406" rx="18.75" ry="18.75" style="stroke: #A80036; stroke-width: 2.25;" width="183" x="95.25" y="1033.4063"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="148.5" x="114.75" y="1067.0918">for each operation</text><polygon fill="#FEFECE" filter="url(#f12p1fqaosbsqh)" points="112.5,1691.25,261,1691.25,279,1709.25,261,1727.25,112.5,1727.25,94.5,1709.25,112.5,1691.25" style="stroke: #A80036; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="16.5" lengthAdjust="spacingAndGlyphs" textLength="148.5" x="112.5" y="1716.0015">has more operations</text><ellipse cx="186.75" cy="1772.25" fill="#FFFFFF" filter="url(#f12p1fqaosbsqh)" rx="15" ry="15" style="stroke: #000000; stroke-width: 2.25;"/><line style="stroke: #000000; stroke-width: 3.75;" x1="177.4692" x2="196.0308" y1="1762.9692" y2="1781.5308"/><line style="stroke: #000000; stroke-width: 3.75;" x1="196.0308" x2="177.4692" y1="1762.9692" y2="1781.5308"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="45" y2="75"/><polygon fill="#A80036" points="180.75,60,186.75,75,192.75,60,186.75,66" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="127.6406" y2="157.6406"/><polygon fill="#A80036" points="180.75,142.6406,186.75,157.6406,192.75,142.6406,186.75,148.6406" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="375.5625" y2="405.5625"/><polygon fill="#A80036" points="180.75,390.5625,186.75,405.5625,192.75,390.5625,186.75,396.5625" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="623.4844" y2="653.4844"/><polygon fill="#A80036" points="180.75,638.4844,186.75,653.4844,192.75,638.4844,186.75,644.4844" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="706.125" y2="736.125"/><polygon fill="#A80036" points="180.75,721.125,186.75,736.125,192.75,721.125,186.75,727.125" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="540.8438" y2="570.8438"/><polygon fill="#A80036" points="180.75,555.8438,186.75,570.8438,192.75,555.8438,186.75,561.8438" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="251.25" x2="327" y1="836.7656" y2="836.7656"/><polygon fill="#A80036" points="321,690.6445,327,675.6445,333,690.6445,327,684.6445" style="stroke: #A80036; stroke-width: 2.25;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="327" x2="327" y1="514.5234" y2="836.7656"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="327" x2="226.5" y1="514.5234" y2="514.5234"/><polygon fill="#A80036" points="241.5,508.5234,226.5,514.5234,241.5,520.5234,235.5,514.5234" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="788.7656" y2="818.7656"/><polygon fill="#A80036" points="180.75,803.7656,186.75,818.7656,192.75,803.7656,186.75,809.7656" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="458.2031" y2="488.2031"/><polygon fill="#A80036" points="180.75,473.2031,186.75,488.2031,192.75,473.2031,186.75,479.2031" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="292.9219" y2="322.9219"/><polygon fill="#A80036" points="180.75,307.9219,186.75,322.9219,192.75,307.9219,186.75,313.9219" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="303" x2="363" y1="902.7656" y2="902.7656"/><polygon fill="#A80036" points="357,599.6836,363,584.6836,369,599.6836,363,593.6836" style="stroke: #A80036; stroke-width: 2.25;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="363" x2="363" y1="266.6016" y2="902.7656"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="363" x2="305.25" y1="266.6016" y2="266.6016"/><polygon fill="#A80036" points="320.25,260.6016,305.25,266.6016,320.25,272.6016,314.25,266.6016" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="854.7656" y2="884.7656"/><polygon fill="#A80036" points="180.75,869.7656,186.75,884.7656,192.75,869.7656,186.75,875.7656" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="210.2813" y2="240.2813"/><polygon fill="#A80036" points="180.75,225.2813,186.75,240.2813,192.75,225.2813,186.75,231.2813" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="920.7656" y2="950.7656"/><polygon fill="#A80036" points="180.75,935.7656,186.75,950.7656,192.75,935.7656,186.75,941.7656" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1168.6875" y2="1198.6875"/><polygon fill="#A80036" points="180.75,1183.6875,186.75,1198.6875,192.75,1183.6875,186.75,1189.6875" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1251.3281" y2="1281.3281"/><polygon fill="#A80036" points="180.75,1266.3281,186.75,1281.3281,192.75,1266.3281,186.75,1272.3281" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="133.5" x2="108.75" y1="1464.6094" y2="1464.6094"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="108.75" x2="108.75" y1="1464.6094" y2="1497.6094"/><polygon fill="#A80036" points="102.75,1482.6094,108.75,1497.6094,114.75,1482.6094,108.75,1488.6094" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="240" x2="264.75" y1="1464.6094" y2="1464.6094"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="264.75" x2="264.75" y1="1464.6094" y2="1497.6094"/><polygon fill="#A80036" points="258.75,1482.6094,264.75,1497.6094,270.75,1482.6094,264.75,1488.6094" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="108.75" x2="108.75" y1="1550.25" y2="1577.25"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="108.75" x2="168.75" y1="1577.25" y2="1577.25"/><polygon fill="#A80036" points="153.75,1571.25,168.75,1577.25,153.75,1583.25,159.75,1577.25" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="264.75" x2="264.75" y1="1550.25" y2="1577.25"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="264.75" x2="204.75" y1="1577.25" y2="1577.25"/><polygon fill="#A80036" points="219.75,1571.25,204.75,1577.25,219.75,1583.25,213.75,1577.25" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1416.6094" y2="1446.6094"/><polygon fill="#A80036" points="180.75,1431.6094,186.75,1446.6094,192.75,1431.6094,186.75,1437.6094" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="256.5" x2="330" y1="1643.25" y2="1643.25"/><polygon fill="#A80036" points="324,1531.7695,330,1516.7695,336,1531.7695,330,1525.7695" style="stroke: #A80036; stroke-width: 2.25;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="330" x2="330" y1="1390.2891" y2="1643.25"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="330" x2="252" y1="1390.2891" y2="1390.2891"/><polygon fill="#A80036" points="267,1384.2891,252,1390.2891,267,1396.2891,261,1390.2891" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1595.25" y2="1625.25"/><polygon fill="#A80036" points="180.75,1610.25,186.75,1625.25,192.75,1610.25,186.75,1616.25" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1333.9688" y2="1363.9688"/><polygon fill="#A80036" points="180.75,1348.9688,186.75,1363.9688,192.75,1348.9688,186.75,1354.9688" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1086.0469" y2="1116.0469"/><polygon fill="#A80036" points="180.75,1101.0469,186.75,1116.0469,192.75,1101.0469,186.75,1107.0469" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="279" x2="368.25" y1="1709.25" y2="1709.25"/><polygon fill="#A80036" points="362.25,1407.7383,368.25,1392.7383,374.25,1407.7383,368.25,1401.7383" style="stroke: #A80036; stroke-width: 2.25;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="368.25" x2="368.25" y1="1059.7266" y2="1709.25"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="368.25" x2="278.25" y1="1059.7266" y2="1059.7266"/><polygon fill="#A80036" points="293.25,1053.7266,278.25,1059.7266,293.25,1065.7266,287.25,1059.7266" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1661.25" y2="1691.25"/><polygon fill="#A80036" points="180.75,1676.25,186.75,1691.25,192.75,1676.25,186.75,1682.25" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1003.4063" y2="1033.4063"/><polygon fill="#A80036" points="180.75,1018.4063,186.75,1033.4063,192.75,1018.4063,186.75,1024.4063" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 2.25;" x1="186.75" x2="186.75" y1="1727.25" y2="1757.25"/><polygon fill="#A80036" points="180.75,1742.25,186.75,1757.25,192.75,1742.25,186.75,1748.25" style="stroke: #A80036; stroke-width: 1.5;"/><!--MD5=[34558128f0f7ba1f0d3d96352d52fadd]
@startuml
scale 600 width
start
:create tagging operation;
:add tags with metadata;
repeat : for each document to tag;
    :identify shard for document;
    :extract with ids from family id path;
    repeat : get id;
        :create sub operation for id;
        :add shard;
        :add required tag ids;
    repeat while(has more ids) is (yes);
repeat while(has more documents to tag);

:send operation to Elasticsearch;
repeat : for each operation;
    :load stored Painless script;
    :extract tag metadata;
    :load document from specified shard;
    repeat : for each tag;
        if (tag exists) then (yes)
            :apply tag and index;
        else (no)
            :skip;
        endif
    repeat while (has more tags);
repeat while (has more operations);
end
@enduml

PlantUML version 1.2020.03beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.4+10-b304.77
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>